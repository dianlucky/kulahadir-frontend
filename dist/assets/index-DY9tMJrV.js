import{a9 as A,aa as z,h as E,z as S,r as f,j as e,T as r,D as g,I as M,B as u,a5 as I,c as y,i as b,$ as N,m as W,b as R}from"./index-62kOrHCL.js";import{u as K}from"./updateSchedule-Cl3jBgu_.js";import{I as T}from"./IconUsers-BSEzDkAQ.js";import{I as C}from"./IconTrash-Cyzk6es1.js";import{I as U}from"./IconCalendar-B9aPoEdi.js";import{D as G}from"./DatePicker-gd_gvPyw.js";import{a as $,b as V}from"./getSchedule-DBwyRqTn.js";import{I as F}from"./IconChevronLeft-3Kw0OlEi.js";import"./use-dates-state-DKWOd2wD.js";function H(l,n,t){const[c,s]=A(t==null?void 0:t.in,l,n);return+z(c)==+z(s)}const Y="https://dianlucky.my.id/api",q=({date:l,refetchSchedule:n,refetchPaidLeaveDaily:t,schedulesOff:c})=>{const{creds:s}=E(),[j,{open:i,close:o}]=S(!1),[d,m]=f.useState(),x=K(),v=async()=>{const a={date:l,employee_id:d==null?void 0:d.employee_id,status:"on"};await x.mutateAsync(a,{onSuccess:h=>{console.log("Success:",h),n(),t(),N({message:"Berhasil menghapus cuti",color:"green",position:"top-center"}),o()}})},[O,{open:_,close:p}]=S(!1),B=async a=>{a.preventDefault();const h={date:l,employee_id:s==null?void 0:s.employee_id,status:"off"};await x.mutateAsync(h,{onSuccess:()=>{n(),t(),N({message:"Berhasil mengajukan cuti",color:"red",position:"top-center"}),p()},onError:L=>{var D,k;const w=L,P=((k=(D=w==null?void 0:w.response)==null?void 0:D.data)==null?void 0:k.errors)||"Gagal menghapus kategori. Silakan coba lagi.";p(),N({message:P,color:"red",position:"top-center"})}})};return e.jsxs("section",{className:"mx-auto max-w-sm bg-white w-full shadow-lg rounded-xl z-50 relative p-2 px-2 text-slate-700 mb-4 mt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs items-center p-2 px-2 -mt-1 -mb-1",children:[e.jsx("div",{children:e.jsx(r,{fw:700,c:"#654433",children:"Pegawai yang cuti"})}),e.jsx("div",{className:"my-auto text-right mb-1 me-2",children:e.jsx(T,{})})]}),e.jsx(g,{size:"sm"}),c.length!=0&&e.jsx(e.Fragment,{children:[...c].sort((a,h)=>h.employee.account.status.localeCompare(a.employee.account.status)).map((a,h)=>e.jsxs("div",{className:"px-2",children:[e.jsxs("div",{className:"grid grid-cols-12 p-2 mb-2",children:[e.jsx("div",{className:"col-span-2 m-auto",children:e.jsx(M,{radius:"30px",h:40,w:40,src:a.employee.profile_pic?`${Y}/uploads/employees/${a.employee.profile_pic}`:"/images/profile-default.png"})}),e.jsxs("div",{className:"col-span-8 ml-2",children:[e.jsx("div",{children:e.jsx(r,{fw:700,size:"md",truncate:"end",children:a.employee.name})}),e.jsx("div",{children:e.jsx(g,{})}),e.jsx("div",{children:e.jsx(r,{fw:400,size:"xs",children:a.employee.account.status})})]}),e.jsx("div",{className:"col-span-1"}),e.jsxs("div",{className:"col-span-1 my-auto",children:[(s==null?void 0:s.level)=="Owner"&&e.jsx(u,{color:"red",size:"compact-xs",onClick:()=>{i(),m(a)},children:e.jsx(C,{size:15})}),(s==null?void 0:s.employee_id)==a.employee_id&&e.jsx(u,{color:"red",size:"compact-xs",onClick:()=>{i(),m(a)},children:e.jsx(C,{size:15})})]})]}),e.jsx(g,{size:"sm"})]},h))}),c.length==0&&e.jsx("div",{className:"p-4 rounded-xl",children:e.jsxs("div",{className:"mt-2 px-3 py-2",children:[e.jsx("div",{className:"flex justify-center ml-4",children:e.jsx(M,{src:"/images/not-found.svg",style:{width:"120px"}})}),e.jsx("div",{className:"flex justify-center mt-1",children:e.jsx(r,{fw:700,size:"sm",children:"Tidak ada pegawai yang cuti"})}),(s==null?void 0:s.level)=="Pegawai"&&e.jsx("div",{className:"flex justify-center mt-2",children:e.jsx(u,{size:"compact-sm",onClick:_,color:"yellow",children:"Saya ingin cuti"})})]})}),e.jsx(I,{opened:O,onClose:p,title:"Konfirmasi cuti pegawai",children:e.jsx("form",{onSubmit:B,children:e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"text-center w-full",children:[e.jsx(r,{size:"sm",fw:600,children:"Apakah anda yakin ingin mengajukan cuti pada hari"}),e.jsxs(r,{size:"sm",fw:600,c:"blue",children:['"',y(new Date(l??""),"EEEE, dd MMMM yyyy",{locale:b}),'"']})]}),e.jsxs("div",{className:"mt-4 flex justify-between gap-2",children:[e.jsx(u,{onClick:()=>{p()},fullWidth:!0,color:"grey",children:"Batal"}),e.jsx(u,{fullWidth:!0,type:"submit",children:"Ya! Ajukan"})]})]})})}),e.jsx(I,{opened:j,onClose:o,title:"Konfirmasi hapus cuti",children:e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(r,{fw:700,size:"sm",children:"Apakah anda yakin ingin membatalkan cuti anda pada hari"}),e.jsxs(r,{fw:700,size:"sm",c:"red",children:['"',y(new Date(l??""),"EEEE, dd MMMM yyyy",{locale:b}),'"']})]}),e.jsxs("div",{className:"mt-4 flex justify-between gap-2",children:[e.jsx(u,{onClick:()=>{p()},fullWidth:!0,color:"grey",children:"Kembali"}),e.jsx(u,{fullWidth:!0,onClick:()=>{v()},color:"red",children:"Hapus"})]})]})})]})},J=({setDate:l,indicatorOff:n,RefetchIndicator:t})=>{const[c,s]=f.useState(new Date),j=i=>{if(s(i),i){const o=y(i,"yyyy-MM-dd");l(o)}};return e.jsxs("section",{className:"mx-auto max-w-sm bg-white w-full shadow-lg rounded-xl z-50 relative p-2 px-2 text-slate-700 mb-4 mt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs items-center p-2 px-2 -mt-1 -mb-1",children:[e.jsx("div",{children:e.jsx(r,{fw:700,c:"#654433",children:"Kalender"})}),e.jsx("div",{className:"my-auto text-right mb-1 me-2",children:e.jsx(U,{})})]}),e.jsx(g,{size:"sm"}),e.jsx("div",{className:"flex justify-center mb-3",children:e.jsx(G,{value:c,onChange:j,renderDay:i=>{const o=n.some(m=>m.status==="off"&&H(new Date(m.date),i)),d=i.getDate();return e.jsx(W,{size:6,color:"red",offset:-2,disabled:!o,children:e.jsx("div",{children:d})})}})})]})},ne=()=>{const l=R(),{creds:n}=E(),[t,c]=f.useState(y(new Date,"yyyy-MM-dd")),[s,j]=f.useState([]),{data:i,refetch:o}=$(y(t||new Date,"yyyy-MM",{locale:b}));f.useEffect(()=>{x&&j(i)},[i]);const[d,m]=f.useState([]),{data:x,refetch:v}=V(t,"off");return f.useEffect(()=>{x&&m(x)},[x]),e.jsxs("main",{children:[e.jsx("section",{className:"w-full h-20 bg-brown rounded-b-3xl"}),e.jsx("section",{className:"bg-white mx-5 p-3 shadow-md rounded-lg flex flex-col gap-2 -mt-10",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:e.jsx(F,{onClick:()=>{l(-1)},size:21,className:"font-bold rounded-md"})}),e.jsx("div",{className:"font-semibold text-brown",children:e.jsxs("h2",{className:"font-semibold",children:["Data cuti ",(n==null?void 0:n.level)=="Owner"?"pegawai":""]})}),e.jsx("div",{})]})}),e.jsxs("div",{children:[e.jsx("div",{className:"mt-2 mx-6",children:e.jsx(J,{setDate:c,indicatorOff:s,RefetchIndicator:o})}),e.jsx("div",{className:"-mt-2 mx-6 mb-20",children:e.jsx(q,{date:t,schedulesOff:d,refetchSchedule:o,refetchPaidLeaveDaily:v})})]})]})};export{ne as PaidLeavesOwnerPage};
