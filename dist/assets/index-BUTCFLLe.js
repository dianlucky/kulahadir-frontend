import{r as b,S as W,j as t,M,Z as Y,aM as Me,aL as Re,f as H,u as V,V as J,ab as be,U as ye,Y as X,aZ as ke,X as F,a_ as ve,a$ as Ce,_ as Ue,o as Be,d as Q,e as ee,s as te,D as S,W as Oe,b0 as q,a6 as $e,z as Fe,T as P,c as I,i as U,B,a5 as Ge,b1 as We,$ as N,a8 as He,h as Ve}from"./index-62kOrHCL.js";import{u as qe,I as Ke,M as Ze,T as Ye,a as Je,l as Xe,P as Qe,m as et}from"./marker-BaX7wSpJ.js";import{G as me,u as tt}from"./getDailyTaskEmployee-BERthAp2.js";import{t as je,s as st}from"./index-BUiqZk8o.js";import{B as K}from"./Badge-C41VQzaz.js";import{I as ue}from"./IconClockHour8-CCsIW-KX.js";import{T as at}from"./Tooltip-Cc5e3_sj.js";import{I as G,u as ot}from"./Input-DpgS31uW.js";import{C as we}from"./CheckIcon-DhP5UFX6.js";import{I as nt}from"./IconSquareCheckFilled-CBxfa0Lt.js";import{a as rt}from"./getSchedule-BwEkCXPp.js";import{a as it}from"./getAttendance-CxloHYaj.js";import"./addDays-B8nD4eQ7.js";import"./get-style-object-DUJZA7T_.js";var _e={root:"m_5f75b09e",body:"m_5f6e695e",labelWrapper:"m_d3ea56bb",label:"m_8ee546b8",description:"m_328f68c0",error:"m_8e8a99cc"};const ct=_e,Ne=b.forwardRef(({__staticSelector:e,__stylesApiProps:s,className:o,classNames:a,styles:n,unstyled:r,children:c,label:i,description:l,id:d,disabled:u,error:h,size:m,labelPosition:f="left",bodyElement:k="div",labelElement:y="label",variant:j,style:_,vars:v,mod:p,...x},C)=>{const g=W({name:e,props:s,className:o,style:_,classes:_e,classNames:a,styles:n,unstyled:r});return t.jsx(M,{...g("root"),ref:C,__vars:{"--label-fz":Me(m),"--label-lh":Y(m,"label-lh")},mod:[{"label-position":f},p],variant:j,size:m,...x,children:t.jsxs(M,{component:k,htmlFor:k==="label"?d:void 0,...g("body"),children:[c,t.jsxs("div",{...g("labelWrapper"),"data-disabled":u||void 0,children:[i&&t.jsx(M,{component:y,htmlFor:y==="label"?d:void 0,...g("label"),"data-disabled":u||void 0,children:i}),l&&t.jsx(G.Description,{size:m,__inheritStyles:!1,...g("description"),children:l}),h&&typeof h!="boolean"&&t.jsx(G.Error,{size:m,__inheritStyles:!1,...g("error"),children:h})]})]})})});Ne.displayName="@mantine/core/InlineInput";const Ee=b.createContext(null),lt=Ee.Provider,Pe=()=>b.useContext(Ee),[dt,mt]=Re();var Ie={card:"m_26775b0a"};const ut={withBorder:!0},pt=J((e,{radius:s})=>({card:{"--card-radius":X(s)}})),se=H((e,s)=>{const o=V("CheckboxCard",ut,e),{classNames:a,className:n,style:r,styles:c,unstyled:i,vars:l,checked:d,mod:u,withBorder:h,value:m,onClick:f,defaultChecked:k,onChange:y,...j}=o,_=W({name:"CheckboxCard",classes:Ie,props:o,className:n,style:r,classNames:a,styles:c,unstyled:i,vars:l,varsResolver:pt,rootSelector:"card"}),v=Pe(),p=typeof d=="boolean"?d:v?v.value.includes(m||""):void 0,[x,C]=be({value:p,defaultValue:k,finalValue:!1,onChange:y});return t.jsx(dt,{value:{checked:x},children:t.jsx(ye,{ref:s,mod:[{"with-border":h,checked:x},u],..._("card"),...j,role:"checkbox","aria-checked":x,onClick:g=>{f==null||f(g),v==null||v.onChange(m||""),C(!x)}})})});se.displayName="@mantine/core/CheckboxCard";se.classes=Ie;function ht({children:e,role:s}){const o=ot();return o?t.jsx("div",{role:s,"aria-labelledby":o.labelId,"aria-describedby":o.describedBy,children:e}):t.jsx(t.Fragment,{children:e})}const ft={},ae=H((e,s)=>{const{value:o,defaultValue:a,onChange:n,size:r,wrapperProps:c,children:i,readOnly:l,...d}=V("CheckboxGroup",ft,e),[u,h]=be({value:o,defaultValue:a,finalValue:[],onChange:n}),m=f=>{const k=typeof f=="string"?f:f.currentTarget.value;!l&&h(u.includes(k)?u.filter(y=>y!==k):[...u,k])};return t.jsx(lt,{value:{value:u,onChange:m,size:r},children:t.jsx(G.Wrapper,{size:r,ref:s,...c,...d,labelElement:"div",__staticSelector:"CheckboxGroup",children:t.jsx(ht,{role:"group",children:i})})})});ae.classes=G.Wrapper.classes;ae.displayName="@mantine/core/CheckboxGroup";var Se={indicator:"m_5e5256ee",icon:"m_1b1c543a","indicator--outline":"m_76e20374"};const xt={icon:we},gt=J((e,{radius:s,color:o,size:a,iconColor:n,variant:r,autoContrast:c})=>{const i=ke({color:o||e.primaryColor,theme:e}),l=i.isThemeColor&&i.shade===void 0?`var(--mantine-color-${i.color}-outline)`:i.color;return{indicator:{"--checkbox-size":Y(a,"checkbox-size"),"--checkbox-radius":s===void 0?void 0:X(s),"--checkbox-color":r==="outline"?l:F(o,e),"--checkbox-icon-color":n?F(n,e):Ce(c,e)?ve({color:o,theme:e,autoContrast:c}):void 0}}}),oe=H((e,s)=>{const o=V("CheckboxIndicator",xt,e),{classNames:a,className:n,style:r,styles:c,unstyled:i,vars:l,icon:d,indeterminate:u,radius:h,color:m,iconColor:f,autoContrast:k,checked:y,mod:j,variant:_,disabled:v,...p}=o,x=d,C=W({name:"CheckboxIndicator",classes:Se,props:o,className:n,style:r,classNames:a,styles:c,unstyled:i,vars:l,varsResolver:gt,rootSelector:"indicator"}),g=mt(),A=typeof y=="boolean"||typeof u=="boolean"?y||u:(g==null?void 0:g.checked)||!1;return t.jsx(M,{ref:s,...C("indicator",{variant:_}),variant:_,mod:[{checked:A,disabled:v},j],...p,children:t.jsx(x,{indeterminate:u,...C("icon")})})});oe.displayName="@mantine/core/CheckboxIndicator";oe.classes=Se;var Te={root:"m_bf2d988c",inner:"m_26062bec",input:"m_26063560",icon:"m_bf295423","input--outline":"m_215c4542"};const bt={labelPosition:"right",icon:we},yt=J((e,{radius:s,color:o,size:a,iconColor:n,variant:r,autoContrast:c})=>{const i=ke({color:o||e.primaryColor,theme:e}),l=i.isThemeColor&&i.shade===void 0?`var(--mantine-color-${i.color}-outline)`:i.color;return{root:{"--checkbox-size":Y(a,"checkbox-size"),"--checkbox-radius":s===void 0?void 0:X(s),"--checkbox-color":r==="outline"?l:F(o,e),"--checkbox-icon-color":n?F(n,e):Ce(c,e)?ve({color:o,theme:e,autoContrast:c}):void 0}}}),R=H((e,s)=>{const o=V("Checkbox",bt,e),{classNames:a,className:n,style:r,styles:c,unstyled:i,vars:l,color:d,label:u,id:h,size:m,radius:f,wrapperProps:k,checked:y,labelPosition:j,description:_,error:v,disabled:p,variant:x,indeterminate:C,icon:g,rootRef:A,iconColor:ne,onChange:L,autoContrast:re,mod:E,...w}=o,D=Pe(),Ae=m||(D==null?void 0:D.size),Le=g,$=W({name:"Checkbox",props:o,classes:Te,className:n,style:r,classNames:a,styles:c,unstyled:i,vars:l,varsResolver:yt}),{styleProps:De,rest:ie}=Ue(w),ce=Be(h),le=D?{checked:D.value.includes(ie.value),onChange:de=>{D.onChange(de),L==null||L(de)}}:{},ze=b.useRef(null),z=s||ze;return b.useEffect(()=>{z&&"current"in z&&z.current&&(z.current.indeterminate=C||!1)},[C,z]),t.jsx(Ne,{...$("root"),__staticSelector:"Checkbox",__stylesApiProps:o,id:ce,size:Ae,labelPosition:j,label:u,description:_,error:v,disabled:p,classNames:a,styles:c,unstyled:i,"data-checked":le.checked||y||void 0,variant:x,ref:A,mod:E,...De,...k,children:t.jsxs(M,{...$("inner"),mod:{"data-label-position":j},children:[t.jsx(M,{component:"input",id:ce,ref:z,checked:y,disabled:p,mod:{error:!!v,indeterminate:C},...$("input",{focusable:!0,variant:x}),onChange:L,...ie,...le,type:"checkbox"}),t.jsx(Le,{indeterminate:C,...$("icon")})]})})});R.classes={...Te,...ct};R.displayName="@mantine/core/Checkbox";R.Group=ae;R.Indicator=oe;R.Card=se;const pe=-3.7931785830447957,he=114.77492278802839,fe=200;function xe(e,s,o,a){const r=(o-e)*Math.PI/180,c=(a-s)*Math.PI/180,i=.5-Math.cos(r)/2+Math.cos(e*Math.PI/180)*Math.cos(o*Math.PI/180)*(1-Math.cos(c))/2;return 6371*2*Math.asin(Math.sqrt(i))*1e3}const kt=()=>{const[e,s]=b.useState(!1),[o,a]=b.useState(null),[n,r]=b.useState(null);return b.useEffect(()=>{(async()=>{var i;try{if(((i=window.Capacitor)!=null&&i.getPlatform?window.Capacitor.getPlatform():"web")==="web")"geolocation"in navigator?navigator.geolocation.getCurrentPosition(d=>{const u=d.coords.latitude,h=d.coords.longitude;a({lat:u,lng:h});const m=xe(u,h,pe,he);r(m),s(m<=fe)},d=>{console.error("Gagal mengambil lokasi di browser:",d),s(!1)}):(console.error("Geolocation tidak didukung di browser"),s(!1));else{const d=await me.requestPermissions();console.log("Permission response:",d);const u=await me.getCurrentPosition(),h=u.coords.latitude,m=u.coords.longitude;a({lat:h,lng:m});const f=xe(h,m,pe,he);r(f),s(f<=fe)}}catch(l){console.error("Gagal mengambil lokasi:",l),s(!1)}})()},[]),{statusLocation:e,userCoords:o,distanceToOffice:n}},vt="https://dianlucky.my.id/api";async function Ct(e){return(await ee.post(`${vt}/attendances/`,e,{headers:{Authorization:`Bearer ${te.getToken()}`,"Content-Type":"multipart/form-data"}})).data}const jt=()=>Q({mutationFn:e=>Ct(e)}),wt="https://dianlucky.my.id/api";async function _t(e,s){return(await ee.patch(`${wt}/daily-task-employees/${e}`,s,{headers:{Authorization:`Bearer ${te.getToken()}`}})).data}const Nt=()=>Q({mutationFn:({id:e,data:s})=>_t(e,s)}),Et="https://dianlucky.my.id/api";async function Pt(e,s){return(await ee.patch(`${Et}/attendances/${e}`,s,{headers:{Authorization:`Bearer ${te.getToken()}`}})).data}const It=e=>Q({mutationFn:s=>Pt(e,s)});function St(){return qe().map}const Tt=({center:e})=>{const s=St();return b.useEffect(()=>{s.flyTo(e,15)},[e,s]),null},At=({long:e,lat:s})=>{const a=s&&e?[s,e]:[-3.793295021545682,114.77480115323222];return t.jsxs("section",{className:"bg-white mx-auto max-w-sm w-full -mt-10 shadow-lg rounded-xl z-50 relative p-4 text-slate-700",children:[t.jsxs("div",{className:"flex justify-between text-xs items-center mb-2",children:[t.jsx("span",{className:"text-base font-bold text-brown",children:"Lokasi"}),t.jsx(Ke,{className:"opacity-80",size:20})]}),t.jsx(S,{size:"xs",className:"mb-2"}),t.jsx("div",{className:"w-full h-64 overflow-hidden rounded-md",children:t.jsxs(Ze,{center:a,zoom:15,scrollWheelZoom:!1,style:{height:"100%",width:"100%"},children:[t.jsx(Ye,{attribution:'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t.jsx(Je,{position:a,icon:new Xe.Icon({iconUrl:et,iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]}),children:t.jsx(Qe,{children:"Lokasi anda."})}),t.jsx(Tt,{center:a})]})})]})};var T;(function(e){e.Prompt="PROMPT",e.Camera="CAMERA",e.Photos="PHOTOS"})(T||(T={}));var O;(function(e){e.Rear="REAR",e.Front="FRONT"})(O||(O={}));var Z;(function(e){e.Uri="uri",e.Base64="base64",e.DataUrl="dataUrl"})(Z||(Z={}));class Lt extends Oe{async getPhoto(s){return new Promise(async(o,a)=>{if(s.webUseInput||s.source===T.Photos)this.fileInputExperience(s,o,a);else if(s.source===T.Prompt){let n=document.querySelector("pwa-action-sheet");n||(n=document.createElement("pwa-action-sheet"),document.body.appendChild(n)),n.header=s.promptLabelHeader||"Photo",n.cancelable=!1,n.options=[{title:s.promptLabelPhoto||"From Photos"},{title:s.promptLabelPicture||"Take Picture"}],n.addEventListener("onSelection",async r=>{r.detail===0?this.fileInputExperience(s,o,a):this.cameraExperience(s,o,a)})}else this.cameraExperience(s,o,a)})}async pickImages(s){return new Promise(async(o,a)=>{this.multipleFileInputExperience(o,a)})}async cameraExperience(s,o,a){if(customElements.get("pwa-camera-modal")){const n=document.createElement("pwa-camera-modal");n.facingMode=s.direction===O.Front?"user":"environment",document.body.appendChild(n);try{await n.componentOnReady(),n.addEventListener("onPhoto",async r=>{const c=r.detail;c===null?a(new q("User cancelled photos app")):c instanceof Error?a(c):o(await this._getCameraPhoto(c,s)),n.dismiss(),document.body.removeChild(n)}),n.present()}catch{this.fileInputExperience(s,o,a)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(s,o,a)}fileInputExperience(s,o,a){let n=document.querySelector("#_capacitor-camera-input");const r=()=>{var c;(c=n.parentNode)===null||c===void 0||c.removeChild(n)};n||(n=document.createElement("input"),n.id="_capacitor-camera-input",n.type="file",n.hidden=!0,document.body.appendChild(n),n.addEventListener("change",c=>{const i=n.files[0];let l="jpeg";if(i.type==="image/png"?l="png":i.type==="image/gif"&&(l="gif"),s.resultType==="dataUrl"||s.resultType==="base64"){const d=new FileReader;d.addEventListener("load",()=>{if(s.resultType==="dataUrl")o({dataUrl:d.result,format:l});else if(s.resultType==="base64"){const u=d.result.split(",")[1];o({base64String:u,format:l})}r()}),d.readAsDataURL(i)}else o({webPath:URL.createObjectURL(i),format:l}),r()}),n.addEventListener("cancel",c=>{a(new q("User cancelled photos app")),r()})),n.accept="image/*",n.capture=!0,s.source===T.Photos||s.source===T.Prompt?n.removeAttribute("capture"):s.direction===O.Front?n.capture="user":s.direction===O.Rear&&(n.capture="environment"),n.click()}multipleFileInputExperience(s,o){let a=document.querySelector("#_capacitor-camera-input-multiple");const n=()=>{var r;(r=a.parentNode)===null||r===void 0||r.removeChild(a)};a||(a=document.createElement("input"),a.id="_capacitor-camera-input-multiple",a.type="file",a.hidden=!0,a.multiple=!0,document.body.appendChild(a),a.addEventListener("change",r=>{const c=[];for(let i=0;i<a.files.length;i++){const l=a.files[i];let d="jpeg";l.type==="image/png"?d="png":l.type==="image/gif"&&(d="gif"),c.push({webPath:URL.createObjectURL(l),format:d})}s({photos:c}),n()}),a.addEventListener("cancel",r=>{o(new q("User cancelled photos app")),n()})),a.accept="image/*",a.click()}_getCameraPhoto(s,o){return new Promise((a,n)=>{const r=new FileReader,c=s.type.split("/")[1];o.resultType==="uri"?a({webPath:URL.createObjectURL(s),format:c,saved:!1}):(r.readAsDataURL(s),r.onloadend=()=>{const i=r.result;o.resultType==="dataUrl"?a({dataUrl:i,format:c,saved:!1}):a({base64String:i.split(",")[1],format:c,saved:!1})},r.onerror=i=>{n(i)})})}async checkPermissions(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const ge=$e("Camera",{web:()=>new Lt}),Dt=({schedule:e,attendance:s,statusLocation:o,long:a,lat:n,RefetchSchedule:r,RefetchAttendance:c,dailyTask:i})=>{console.log("jadwal :",e);const[l,{open:d,close:u}]=Fe(!1),h=jt(),m=async()=>{try{const p=We.getPlatform();if(p!=="web"){const w=await ge.requestPermissions();if(console.log("[PERMISSION]",w),w.camera!=="granted"){console.error("Izin kamera ditolak"),N({message:"Izin kamera diperlukan untuk check-in",color:"red",position:"top-center"});return}}const x=await ge.getPhoto({quality:90,allowEditing:!1,resultType:Z.Base64,source:T.Camera,width:1024,height:1024,correctOrientation:!0,saveToGallery:!1});if(!x||!x.base64String){console.error("Tidak ada foto yang diambil"),N({message:"Foto gagal diambil",color:"red",position:"top-center"});return}console.log("[CHECK-IN] Platform:",p),console.log("[CHECK-IN] Photo success");const C=x.base64String,g=atob(C),A=new Array(g.length);for(let w=0;w<g.length;w++)A[w]=g.charCodeAt(w);const ne=new Uint8Array(A),L=new Blob([ne],{type:"image/jpeg"}),re=new File([L],`snapshot-${Date.now()}.jpeg`,{type:"image/jpeg"});if(n==null||a==null){N({message:"Lokasi belum tersedia, coba lagi nanti",color:"red",position:"top-center"});return}const E=new FormData;E.append("check_in",new Date().toISOString()),E.append("attendanc_lat",String(n)),E.append("attendance_long",String(a)),E.append("schedule_id",String((e==null?void 0:e.id)??"")),E.append("snapshot",re),await h.mutateAsync(E,{onSuccess:w=>{console.log("Check-in berhasil",w),c(),r(),N({message:"Check-in sukses",color:"green",position:"top-center"})},onError:w=>{console.error("Gagal check-in",w),N({message:"Check-in gagal",color:"red",position:"top-center"})}})}catch(p){console.error("Error saat check-in:",p),N({message:"Terjadi kesalahan saat check-in",color:"red",position:"top-center"})}},f=It(s==null?void 0:s.id),k=async()=>{const p={check_out:new Date,schedule_id:e==null?void 0:e.id};await f.mutateAsync(p,{onSuccess:x=>{console.log("Success:",x),c(),r(),N({message:"Check-out sukses, Terimakasih ðŸ˜‰",color:"green",position:"top-center"}),u()}})},y=je(new Date,"Asia/Makassar"),j=y.getHours(),_=y.getMinutes(),v=()=>{const p=j;return p===23&&_>=30||p>=0&&p<3};return t.jsxs("section",{className:"bg-white mx-auto max-w-sm w-full shadow-lg rounded-xl z-50 relative p-4",children:[t.jsxs("div",{className:"flex justify-between text-xs items-center mb-2",children:[t.jsx("span",{className:"text-base font-bold text-brown",children:"Absensi"}),t.jsxs("div",{className:"flex justify-between -gap-1",children:[s&&s.status=="Working"?t.jsx(K,{size:"xs",color:(s==null?void 0:s.status)=="Working"?"yellow":"green",radius:"xs",mr:5,children:s==null?void 0:s.status}):t.jsx(K,{size:"xs",color:(e==null?void 0:e.attendance_status)=="belum hadir"?"red":(e==null?void 0:e.attendance_status)=="Working"?"yellow":"green",radius:"xs",mr:5,children:e==null?void 0:e.attendance_status}),t.jsx(K,{size:"xs",color:(e==null?void 0:e.status)=="off"?"red":"green",radius:"xs",mr:5,children:e==null?void 0:e.status})]})]}),t.jsx(S,{size:"xs",className:"mb-2"}),t.jsxs("div",{className:"grid grid-cols-12 px-2",children:[t.jsx("div",{className:"col-span-2 text-center m-auto -ml-2",children:t.jsx(P,{fw:"bold",size:"40px",children:e==null?void 0:e.shift_code})}),t.jsx("div",{className:"col-span-1 text-center",children:t.jsx("div",{className:"w-px h-full bg-gray-300 mx-4"})}),t.jsxs("div",{className:"col-span-9 ml-2",children:[t.jsx("div",{className:"mt-2",children:t.jsx(P,{fw:600,size:"15px",children:e&&I(e.date,"EEEE, dd MMM yyyy",{locale:U})})}),t.jsx("div",{className:"py-2",children:t.jsx(S,{})}),t.jsx("div",{className:"mt-1",children:t.jsxs(P,{fw:600,size:"15px",children:[e==null?void 0:e.start_time,"- ",e==null?void 0:e.end_time]})})]})]}),t.jsx("div",{className:"mt-2",children:t.jsx(S,{})}),t.jsxs("div",{className:"flex justify-between text-xs p-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx(ue,{size:15,className:"text-green-400"})," Masuk :"," ",s!=null&&s.check_in?I(new Date(s.check_in),"HH:mm",{locale:U}):"--:--"]}),t.jsx("div",{children:t.jsx("div",{className:"w-px h-full bg-gray-300 mx-4"})}),t.jsxs("div",{className:"ps-3 flex gap-2",children:[t.jsx(ue,{size:15,className:"text-rose-400"})," Keluar :"," ",s!=null&&s.check_out?I(new Date(s.check_out),"HH:mm",{locale:U}):"--:--"]})]}),t.jsxs("div",{className:"w-full px-1 mt-1",children:[(e==null?void 0:e.attendance_status)=="belum hadir"&&t.jsx(B,{size:"sm",fullWidth:!0,disabled:e.status!=="on"||!o,onClick:m,children:e.status==="off"?"Anda sedang cuti":o?"CHECK-IN":"Anda berada di luar lokasi kerja"}),((e==null?void 0:e.attendance_status)==="Working"||(e==null?void 0:e.attendance_status)==="Late")&&(s==null?void 0:s.status)!=="Done"&&t.jsx(B,{size:"sm",fullWidth:!0,disabled:!o||i.filter(p=>p.status==="Belum").length!==0||!v(),onClick:d,color:"red",children:o?i.filter(p=>p.status==="Belum").length!==0?"Ada tugas yang belum selesai":"CHECK-OUT":"Anda berada di luar lokasi"})]}),t.jsx(Ge,{opened:l,onClose:u,withCloseButton:!1,children:t.jsxs("div",{className:"px-3",children:[t.jsx("div",{className:"text-center mb-1",children:t.jsx(P,{fw:500,size:"md",children:"Apakah anda ingin check-out?"})}),t.jsx(S,{size:"md"}),t.jsxs("div",{className:"bg-slate-100 rounded-xl p-3 mt-2",children:[t.jsx("div",{className:"text-center  mt-2",children:t.jsxs(P,{fw:700,size:"sm",children:["Tanggal :"," ",(e==null?void 0:e.date)&&I(e.date,"EEEE, dd MMMM yyyy",{locale:U})]})}),t.jsx("div",{className:"text-center",children:t.jsxs(P,{fw:700,size:"sm",children:["Waktu masuk :"," ",(s==null?void 0:s.check_in)&&I(s.check_in,"HH:mm",{locale:U})]})})]}),t.jsxs("div",{className:"flex gap-2 mt-4",children:[t.jsx(B,{fullWidth:!0,color:"grey",onClick:()=>u(),children:"Tidak"}),t.jsx(B,{fullWidth:!0,color:"blue",onClick:()=>k(),children:"Ya"})]})]})})]})},zt=({dailyTask:e,RefetchDailyTaskEmployee:s,schedule:o})=>{const[a,n]=b.useState([]),r=l=>{n(d=>d.includes(l)?d.filter(u=>u!==l):[...d,l])},c=Nt(),i=async()=>{if(a.length===0){N({message:"Centang minimal 1 tugas",color:"red"});return}const l={status:"Sudah"};try{for(const d of a)await c.mutateAsync({id:d,data:l});N({message:"Berhasil update status tugas harian",color:"green",position:"top-center"}),s(),close()}catch(d){console.error("Error:",d),N({message:"Gagal update status",color:"red",position:"top-center"})}};return console.log("yang dicentang :",a),t.jsx(t.Fragment,{children:t.jsxs("section",{className:"bg-white mx-auto max-w-sm w-full shadow-lg rounded-xl z-50 relative p-4",children:[t.jsxs("div",{className:"flex justify-between text-xs items-center mb-2",children:[t.jsx("span",{className:"text-base font-bold text-brown",children:"Tugas harian"}),t.jsx(He,{size:22})]}),t.jsx(S,{size:"xs",className:"mb-2"}),e.length!=0&&e.map((l,d)=>t.jsxs("div",{children:[t.jsxs("div",{className:"grid grid-cols-12 px-1",children:[t.jsx("div",{className:"col-span-1 m-auto",children:t.jsx(P,{fw:700,size:"sm",children:l.task_employee.task.task_code})}),t.jsx("div",{className:"col-span-1 ml-1",children:t.jsx("div",{className:"w-px h-full bg-gray-300 mx-4"})}),t.jsx("div",{className:"col-span-9 ml-1 my-auto",children:t.jsx(P,{size:"12px",lineClamp:2,children:l.task_employee.task.task_name})}),t.jsxs("div",{className:"col-span-1 ",children:[l.status=="Belum"&&t.jsx(ye,{children:t.jsx(at,{label:"Tandai tugas ini",children:t.jsx(R,{onChange:()=>r(l.id)})})}),l.status=="Sudah"&&t.jsx("div",{style:{marginLeft:"-2px"},children:t.jsx(nt,{color:"#77B254"})})]})]}),t.jsx("div",{className:"mt-2 mb-2",children:t.jsx(S,{})})]},d)),t.jsx("div",{className:"mt-2",children:t.jsx(B,{fullWidth:!0,size:"sm",disabled:(o==null?void 0:o.attendance_status)=="belum hadir"||e.filter(l=>l.status=="Belum").length==0||a.length==0,onClick:()=>{i()},children:(o==null?void 0:o.attendance_status)=="belum hadir"?"Anda belum CHECK-IN":"Tandai selesai"})})]})})},Yt=()=>{const{creds:e}=Ve(),o=(()=>{const p=je(new Date,"Asia/Makassar");if(p.getHours()<3){const C=st(p);return I(C,"yyyy-MM-dd")}return I(p,"yyyy-MM-dd")})(),[a,n]=b.useState(),{data:r,refetch:c}=rt(e==null?void 0:e.employee_id,o);b.useEffect(()=>{r&&n(r)},[r]);const[i,l]=b.useState(),{data:d,refetch:u}=it(a==null?void 0:a.id);b.useEffect(()=>{d&&l(d)},[d]),console.log("Kehadiran :",i);const{statusLocation:h,userCoords:m,distanceToOffice:f}=kt();b.useEffect(()=>{console.log(h?"âœ… User berada di lokasi absen":"âŒ User di luar jangkauan lokasi absen"),console.log("ðŸ“ Jarak ke kantor:",f,"meter")},[h,f]);const[k,y]=b.useState([]),{data:j,isLoading:_,refetch:v}=tt(o,e==null?void 0:e.employee_id);return b.useEffect(()=>{j&&y(j)},[j]),t.jsxs("main",{children:[t.jsx("section",{className:"w-full h-20 bg-brown rounded-b-3xl"}),t.jsx("div",{className:"mb-2 mx-5",children:t.jsx(At,{long:m==null?void 0:m.lng,lat:m==null?void 0:m.lat})}),t.jsx("div",{className:"mt-2 mx-5",children:t.jsx(Dt,{dailyTask:k,RefetchSchedule:c,RefetchAttendance:u,schedule:a,attendance:i,statusLocation:h,long:m==null?void 0:m.lng,lat:m==null?void 0:m.lat})}),t.jsx("div",{className:"mt-2 mb-20 mx-5",children:!_&&t.jsx(zt,{dailyTask:k,RefetchDailyTaskEmployee:v,schedule:a})})]})};export{Yt as CheckLogPage};
