import{b as E,l as _,j as e,c as M,P as R,B as f,D as C,I as T,T as a,i as O,e as I,s as $,k as V,d as F,h as X,r as d,z as K,U as B,$ as N,a5 as Z}from"./index-BOpnoju3.js";import{S as w}from"./Skeleton-COqBE37v.js";import{I as ee}from"./IconCalendar-CE-ZZ2x_.js";import{D as se}from"./DatePicker-Bh1dFeXP.js";import{I as te,u as ie}from"./getOutgoingDetail-C6O2TfzG.js";import{a as Ve,g as Xe,b as Ze}from"./getOutgoingDetail-C6O2TfzG.js";import{I as ne}from"./IconInfoCircle-A7fbMB4x.js";import{I as P}from"./IconChevronLeft-D1OOjyuq.js";import{I as ae}from"./IconPlus-BU8JKqfB.js";import{T as W}from"./TextInput-BN5wt6Mf.js";import{I as oe,u as le}from"./getItem-Cgui9hrN.js";import{D as Q,I as Y,a as J}from"./IconSquareChevronRightFilled-UacV8CWZ.js";import"./use-dates-state-CvLU8EGr.js";import"./InputBase-b1LtnY3Z.js";import"./Input-CZsZP0m2.js";const ce=({setSelectedDate:s,outgoingData:i,LoadingOutgoingData:n,selectedDate:j})=>{const g=E(),m=_();return e.jsx(e.Fragment,{children:e.jsxs("section",{className:"bg-white mx-auto max-w-sm w-full shadow-lg rounded-md relative p-4",children:[e.jsxs("div",{className:"flex justify-between text-xs items-center mb-2",children:[n?e.jsx(w,{height:10,width:"80%"}):e.jsxs("span",{className:"text-sm font-bold text-brown",children:["Barang keluar,"," ",M(new Date,"EEEE, dd MMM yyyy",{locale:O})]}),e.jsxs(R,{width:300,position:"bottom-end",offset:4,withArrow:!0,shadow:"lg",children:[e.jsx(R.Target,{children:e.jsx(f,{size:"compact-sm",color:"#654433",children:e.jsx(ee,{size:22})})}),e.jsx(R.Dropdown,{children:e.jsx("div",{className:"flex justify-center",children:e.jsx(se,{size:"sm",value:j,onChange:s})})})]})]}),e.jsx(C,{size:"xs",className:"mb-2"}),i.length==0&&e.jsxs("div",{className:"my-10",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(T,{radius:"10px",h:120,w:120,src:"/images/not-found.svg"})}),e.jsx("div",{className:"text-center mt-1",children:e.jsx(a,{size:"sm",fw:600,children:"Data tidak ditemukan"})})]}),i.map((x,k)=>e.jsxs("div",{children:[e.jsxs("div",{className:" px-3",children:[e.jsxs("div",{className:"col-span-12 flex justify-between",children:[e.jsxs("div",{children:[n?e.jsx(w,{height:10,width:"80%"}):e.jsx(a,{size:"xs",fw:400,children:M(new Date,"EEEE, dd MMM yyyy HH:mm",{locale:O})}),e.jsx("div",{className:"flex mt-1",children:n?e.jsx(w,{height:10,width:"50%"}):e.jsxs("div",{className:"flex",children:[e.jsx(te,{size:16,color:"red"}),e.jsx(a,{size:"sm",c:"red",fw:800,mt:-2,ml:3,children:"Stok keluar"})]})})]}),e.jsx("div",{className:"",children:e.jsx(f,{size:"compact-xs",color:"blue",onClick:()=>{g(`/${m.pathname.includes("frozen")?"frozen":"warehouse"}-inventory/outgoing/detail`,{state:{data:x}})},children:e.jsx(ne,{size:17,color:"white"})})})]}),x.details.map((v,y)=>e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsx("div",{className:"col-span-6 mt-1",children:n?e.jsx(w,{height:10,width:"50%"}):e.jsx(a,{size:"sm",fw:500,children:v.item.name})}),e.jsx("div",{className:"col-span-6 text-end",children:n?e.jsx("div",{className:"flex justify-end",children:e.jsx(w,{height:10,width:"10%"})}):e.jsx(a,{size:"md",fw:600,mr:10,children:v.amount})})]},y))]}),e.jsx("div",{className:"my-2",children:e.jsx(C,{})})]},k))]})})},re="https://dianlucky.my.id/api";async function de(s){return(await I.get(`${re}/outgoing-items/by-date?dateString=${s}`,{headers:{Authorization:`Bearer ${$.getToken()}`}})).data.data}const me=s=>V({queryKey:["outgoing-items",s],queryFn:()=>de(s)}),xe="https://dianlucky.my.id/api",he=async s=>(await I.post(`${xe}/outgoing-details/`,s,{headers:{Authorization:`Bearer ${$.getToken()}`}})).data,ue=()=>F({mutationFn:he,onMutate:async()=>{},onError:s=>{console.log("Error :",s)}}),ge="https://dianlucky.my.id/api",je=async s=>(await I.post(`${ge}/outgoing-items/`,s,{headers:{Authorization:`Bearer ${$.getToken()}`}})).data,pe=()=>F({mutationFn:je,onMutate:async()=>{},onError:s=>{console.log("Error :",s)}}),fe="https://dianlucky.my.id/api",ye=async s=>(await I.delete(`${fe}/outgoing-items/${s}`,{headers:{Authorization:`Bearer ${$.getToken()}`}})).data,we=()=>F({mutationFn:s=>ye(s),onError:s=>{console.log(s)}}),ve="https://dianlucky.my.id/api",be=async s=>(await I.delete(`${ve}/outgoing-details/${s}`,{headers:{Authorization:`Bearer ${$.getToken()}`}})).data,Ne=()=>F({mutationFn:s=>be(s),onError:s=>{console.log(s)}}),ke="https://dianlucky.my.id/api";async function ze(s,i){return(await I.patch(`${ke}/incoming-details/${s}`,i,{headers:{Authorization:`Bearer ${$.getToken()}`}})).data}const Se=s=>F({mutationFn:i=>ze(s,i)}),Ce="/images/splash.png",Be="https://dianlucky.my.id/api",De=({items:s,LoadingItems:i})=>{const{creds:n}=X(),j=E(),[g,m]=d.useState(!1),[x,{open:k,close:v}]=K(!1),[y,l]=d.useState(0),[h,D]=d.useState(null),[p,z]=d.useState(0);d.useEffect(()=>{h&&l(h.stock-p)},[p,h]);const[A,G]=d.useState(""),[S,L]=d.useState([]),H=pe(),U=ue(),c=async()=>{if(S.length===0)return;const t=(n==null?void 0:n.employee_id)??1;m(!0);try{const r=(await H.mutateAsync({employee_id:t})).data.id;for(const u of S)await U.mutateAsync({employee_id:t,item_id:u.item_id,outgoing_id:r,amount:u.amount});L([]),D(null),z(0),N({message:"Berhasil menambahkan data",color:"green",position:"top-center"}),j(-1)}catch(o){console.error(o),N({message:"Gagal menambahkan data!",color:"red",position:"top-center"})}finally{m(!1)}};return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"bg-white shadow-md rounded-lg p-2",children:[e.jsx("div",{className:"flex justify-between px-2",children:e.jsx(W,{leftSectionPointerEvents:"none",leftSection:e.jsx(oe,{size:16}),placeholder:"Cari barang ...",radius:"md",size:"sm",value:A??"",onChange:t=>G(t.currentTarget.value)})}),e.jsxs("div",{className:"mt-4",children:[s.filter(t=>t.name.toLowerCase().includes(A?A.toLowerCase():"")).map((t,o)=>e.jsxs("div",{children:[e.jsxs(B,{className:"w-full grid grid-cols-12",onClick:()=>{const r=S.find(u=>u.item_id===t.id);z(0),r&&z(r.amount),D(t),k()},children:[e.jsx("div",{className:"col-span-2 flex justify-center",children:i?e.jsx(w,{height:40,width:"80%"}):e.jsx(T,{radius:"10px",h:35,w:35,src:t.image?`${Be}/uploads/items/${t.image}`:Ce})}),e.jsxs("div",{className:"col-span-8 text-left",children:[i?e.jsx(w,{height:10,width:"80%"}):e.jsx(a,{size:"sm",truncate:"end",fw:700,children:t.name}),i?e.jsx(w,{height:10,width:"20%",mt:16}):e.jsx(a,{size:"xs",truncate:"end",fw:400,mt:-4,children:t.code})]}),e.jsx("div",{className:"col-span-2 text-center my-auto",children:i?e.jsx("div",{className:"flex justify-end mr-3 -mt-2",children:e.jsx(w,{height:23,width:"40%"})}):e.jsx("div",{children:(()=>{const r=S.find(u=>u.item_id===t.id);return r?e.jsxs("div",{children:[e.jsx(a,{size:"md",fw:700,children:t.stock}),e.jsxs(a,{size:"sm",c:"red",fw:600,mt:-4,mr:4,children:["-",r.amount]})]}):e.jsx(a,{size:"xl",fw:700,children:t.stock})})()})})]}),e.jsx("div",{className:"px-2",children:e.jsx(C,{my:10})})]},o)),e.jsx(Q,{opened:x,onClose:v,position:"bottom",withCloseButton:!1,size:"xs",children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(a,{size:"md",fw:500,children:h==null?void 0:h.name}),e.jsx(C,{my:7})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(W,{label:"Stok awal",size:"sm",disabled:!0,value:(h==null?void 0:h.stock)??0}),e.jsx(W,{label:"Stok akhir",size:"sm",disabled:!0,value:y??0})]}),e.jsxs("div",{className:"grid grid-cols-12 text-center",children:[e.jsx("div",{className:"col-span-4 my-auto",children:e.jsx(B,{size:"xl",disabled:p<=0,onClick:()=>z((p??0)-1),children:e.jsx(Y,{size:40,color:"#4B352A"})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(a,{size:"60px",c:"red",fw:700,children:p})}),e.jsx("div",{className:"col-span-4 my-auto",children:e.jsx(B,{size:"xl",disabled:y<=0,onClick:()=>z(t=>t+1),children:e.jsx(J,{size:40,color:"#4B352A"})})})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-8 -mx-3",children:[e.jsx(f,{fullWidth:!0,size:"sm",color:"gray",onClick:v,children:"Batal"}),e.jsx(f,{fullWidth:!0,size:"sm",onClick:()=>{h&&p>0&&L(t=>{const o=t.findIndex(r=>r.item_id===h.id);if(o!==-1){const r=[...t];return r[o].amount=p,r}return[...t,{item_id:h.id,amount:p}]}),v()},children:"Simpan"})]})]})})]})]}),e.jsx("div",{className:"fixed bottom-22 right-4 z-10 w-32",children:e.jsx(f,{size:"sm",disabled:S.length==0,fullWidth:!0,onClick:c,loading:g,children:"Simpan"})})]})},q="https://dianlucky.my.id/api",Ee="/images/profile-default.png",Ie=({outgoingData:s,details:i,RefetchDetails:n})=>{var U;const j=E(),[g,{open:m,close:x}]=K(!1),[k,{open:v,close:y}]=K(!1),[l,h]=d.useState(),[D,p]=d.useState((l==null?void 0:l.amount)??0);d.useEffect(()=>{p(l==null?void 0:l.amount)},[l]);const z=we(),A=async c=>{z.mutateAsync(c,{onSuccess:t=>{console.log("Sukses :",t),N({message:"Data barang keluar berhasil dihapus",color:"green",position:"top-center"}),x(),j(-1)},onError:t=>{var u,b;const o=t,r=((b=(u=o==null?void 0:o.response)==null?void 0:u.data)==null?void 0:b.errors)||"Gagal menghapus barang keluar. Silakan coba lagi.";x(),N({message:r,color:"red",position:"top-center"})}})},G=Ne(),S=async c=>{G.mutateAsync(c,{onSuccess:()=>{n(),N({message:"Detail barang keluar berhasil dihapus",color:"green",position:"top-center"}),y()},onError:t=>{var u,b;const o=t,r=((b=(u=o==null?void 0:o.response)==null?void 0:u.data)==null?void 0:b.errors)||"Gagal menghapus detail. Silakan coba lagi.";x(),N({message:r,color:"red",position:"top-center"})}})},L=Se(l==null?void 0:l.id),H=async()=>{const c={amount:D};await L.mutateAsync(c,{onSuccess:()=>{n(),y(),N({message:"Detail berhasil diubah",color:"green",position:"top-center"}),p(0)},onError:t=>{var u,b;const o=t,r=((b=(u=o==null?void 0:o.response)==null?void 0:u.data)==null?void 0:b.errors)||"Gagal mengubah detail. Silakan coba lagi.";y(),N({message:r,color:"red",position:"top-center"})}})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white shadow-md rounded-md p-4",children:[e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsx("div",{className:"col-span-6",children:e.jsx(a,{size:"xs",fw:400,children:M(s.created_at,"EEEE, dd MMM yyyy HH:mm",{locale:O})})}),e.jsxs("div",{className:"col-span-6 flex justify-end",children:[e.jsx(T,{radius:"10px",h:20,w:20,src:s.employee.profile_pic?`${q}/uploads/employees/${(U=s.employee)==null?void 0:U.profile_pic}`:Ee}),e.jsx(a,{size:"xs",fw:400,truncate:"end",children:s.employee.name})]})]}),e.jsx(C,{my:8}),i.map((c,t)=>e.jsx(B,{onClick:()=>{v(),h(c)},className:"w-full mb-3 px-2",children:e.jsxs("div",{className:"grid grid-cols-12",children:[e.jsx("div",{className:"col-span-2",children:e.jsx(T,{radius:"10px",h:35,w:35,src:c.item.image?`${q}/uploads/items/${c.item.image}`:"/images/splash.png"})}),e.jsxs("div",{className:"col-span-8",children:[e.jsx(a,{size:"sm",fw:600,children:c.item.name}),e.jsx(a,{size:"xs",fw:300,children:c.item.code})]}),e.jsx("div",{className:"col-span-2 text-end",children:e.jsx(a,{size:"xl",fw:700,mr:3,children:c.amount})})]})},t)),e.jsx(C,{}),e.jsxs("div",{className:"flex justify-between gap-2 mt-3",children:[e.jsx(f,{size:"xs",color:"gray",onClick:()=>{j(-1)},fullWidth:!0,children:"Kembali"}),e.jsx(f,{size:"xs",color:"red",onClick:()=>{m()},fullWidth:!0,children:"Hapus"})]})]}),e.jsx(Z,{opened:g,onClose:x,title:"Konfirmasi hapus",children:e.jsxs("div",{className:"px-1",children:[e.jsxs("div",{className:" text-center px-2",children:[e.jsx(a,{size:"sm",fw:500,children:"Apakah anda yakin ingin menghapus seluruh transaksi ini?"}),e.jsxs(a,{size:"sm",c:"red",fw:700,children:['"',M(s.created_at,"EEEE dd MMM yyyy HH:mm",{locale:O})," ","|| ",s.details.length,' Barang "']})]}),e.jsxs("div",{className:"flex justify-betwen gap-2 mt-2 mb-2",children:[e.jsx(f,{color:"grey",size:"xs",fullWidth:!0,onClick:x,children:"Kembali"}),e.jsx(f,{color:"yellow",size:"xs",fullWidth:!0,onClick:()=>{A(s==null?void 0:s.id)},children:"Ya! Hapus"})]})]})}),e.jsx(Q,{opened:k,onClose:()=>{y(),h(void 0)},position:"bottom",withCloseButton:!1,size:"xs",children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(a,{size:"md",fw:500,children:l==null?void 0:l.item.name}),e.jsx(C,{my:7})]}),e.jsxs("div",{className:"grid grid-cols-12 text-center",children:[e.jsx("div",{className:"col-span-4 my-auto",children:e.jsx(B,{size:"xl",disabled:(D??0)<=1,onClick:()=>p(c=>(c??0)-1),children:e.jsx(Y,{size:40,color:"#4B352A"})})}),e.jsx("div",{className:"col-span-4",children:e.jsx(a,{size:"60px",c:"green",fw:700,children:D})}),e.jsx("div",{className:"col-span-4 my-auto",children:e.jsx(B,{size:"xl",onClick:()=>p(c=>(c??0)+1),children:e.jsx(J,{size:40,color:"#4B352A"})})})]}),e.jsxs("div",{className:"flex justify-between gap-2 mt-12 -mx-3",children:[e.jsx(f,{fullWidth:!0,size:"sm",color:"red",onClick:()=>{S(l==null?void 0:l.id)},children:"Hapus"}),e.jsx(f,{fullWidth:!0,size:"sm",color:"blue",onClick:()=>{H()},children:"Ubah"})]})]})})]})},Pe=()=>{const s=_(),i=E(),[n,j]=d.useState(new Date),[g,m]=d.useState([]),{data:x,isLoading:k}=me(M(n??new Date,"yyyy-MM-dd",{locale:O}));return d.useEffect(()=>{m(x||[])}),e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"w-full h-20 bg-brown rounded-b-3xl"}),e.jsx("section",{className:"bg-white mx-5 p-3 shadow-md rounded-lg flex flex-col gap-2 -mt-10",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:e.jsx(P,{onClick:()=>{i(-1)},size:21,className:"font-bold rounded-md"})}),e.jsx("div",{className:"font-semibold text-brown",children:e.jsx("h2",{className:"font-semibold ",children:"Kelola stok keluar"})}),e.jsx("div",{children:e.jsx("div",{className:"mr-2",children:e.jsx(B,{onClick:()=>i(`/${s.pathname.includes("frozen")?"frozen":"warehouse"}-inventory/outgoing/add`),children:e.jsx(ae,{size:22})})})})]})}),e.jsx("section",{children:e.jsx("div",{className:"mt-2 px-7 mb-20",children:e.jsx(ce,{setSelectedDate:j,outgoingData:g,LoadingOutgoingData:k,selectedDate:n})})})]})},qe=()=>{const s=E(),i=_(),[n,j]=d.useState([]),{data:g,isLoading:m}=le(i.pathname.includes("frozen")?"Frozen":"!Frozen");return d.useEffect(()=>{j(g||[])},[g]),e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"w-full h-20 bg-brown rounded-b-3xl"}),e.jsx("section",{className:"bg-white mx-5 p-3 shadow-md rounded-lg flex flex-col gap-2 -mt-10",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:e.jsx(P,{onClick:()=>{s(-1)},size:21,className:"font-bold rounded-md"})}),e.jsx("div",{className:"font-semibold text-brown",children:e.jsx("h2",{className:"font-semibold ",children:"Tambah barang keluar"})}),e.jsx("div",{})]})}),e.jsx("div",{className:"mx-6 mt-2 mb-20",children:e.jsx(De,{items:n,LoadingItems:m})})]})},Qe=()=>{const s=E(),n=_().state.data;console.log("Outgoing data : ",n);const[j,g]=d.useState([]),{data:m,refetch:x}=ie(n.id);return d.useEffect(()=>{g(m||[])},[m]),e.jsxs(e.Fragment,{children:[e.jsx("section",{className:"w-full h-20 bg-brown rounded-b-3xl"}),e.jsx("section",{className:"bg-white mx-5 p-3 shadow-md rounded-lg flex flex-col gap-2 -mt-10",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:e.jsx(P,{onClick:()=>{s(-1)},size:21,className:"font-bold rounded-md"})}),e.jsx("div",{className:"font-semibold text-brown",children:e.jsx("h2",{className:"font-semibold",children:"Detail Barang Keluar"})}),e.jsx("div",{children:e.jsx("div",{className:"mr-2"})})]})}),e.jsx("section",{children:e.jsx("div",{className:"mt-2 px-5 mb-20",children:e.jsx(Ie,{outgoingData:n,details:j,RefetchDetails:x})})})]})};export{qe as AddOutgoingStock,Ie as DetailOutgoingSection,Qe as DetailOutgoingStock,ce as HistoryOutgoingSection,Pe as OutgoingStockPage,De as OutgoingStockSection,Ve as getDetailByItemId,Xe as getDetailByOutgoingId,de as getOutgoingByDate,je as postOugoingItem,he as postOutgoingDetail,ue as useCreateOutgoingDetail,pe as useCreateOutgoingItem,we as useDeleteOutgoingData,Ne as useDeleteOutgoingDetail,ie as useGetDetailByOutgoingId,me as useGetOutgoingByDate,Ze as useGetOutgoingDetailByItemId,Se as useUpdateIncomingDetail};
